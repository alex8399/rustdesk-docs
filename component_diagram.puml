@startuml RustDesk Component Diagram

!theme materia

title RustDesk Architecture Component Diagram

package "Frontend (Client Applications)"as Frontend #LightBlue {
  component "Flutter UI" as FlutterUI <<GUI>>
  () "FFI Interface" as FfiInterface
  component "RustDesk Core" as CoreClient <<Application>>
  component "Web Client" as WebClient <<Browser>>

  CoreClient --|> FfiInterface : provides
  FlutterUI ..> FfiInterface : uses
}

package "Backend (Server Infrastructure)" as Backend #LightGreen {
  component "ID/Rendezvous Server (hbbs)" as IDServer <<Application>>
  component "Relay Server (hbbr)" as RelayServer <<Application>>
  IDServer -[hidden]down- RelayServer
}

package "Shared Libraries (libs)" as SharedLibs #Orange {
  component "hbb_common" as HbbCommon <<Library>>
  note right of HbbCommon
    TCP/UDP,
    Video/Audio Codec,
    File transfer.
  end note

  component "scrap" as Scrap <<Library>>
  note right of Scrap: Screen Capture

  component "enigo" as Enigo <<Library>>
  note right of Enigo: Input Simulation (mouse/keyboard)

  component "port_forward" as PortForward <<Library>>

  HbbCommon -[hidden]down- Enigo
  Enigo -[hidden]down- Scrap
  Scrap -[hidden]down- PortForward
}

package "Platforms" as Platforms #LightGray {
  together {
    component "Windows" as Windows <<OS>>
    component "macOS" as MacOS <<OS>>
    component "Linux" as Linux <<OS>>
  }
  Windows -[hidden]right- MacOS
  MacOS -[hidden]right- Linux
}


Scrap .> Platforms : "Uses OS APIs"
Enigo .> Platforms : "Uses OS APIs"
HbbCommon .> Platforms : "Uses OS APIs"


' Relationships between components
CoreClient ..> HbbCommon
CoreClient ..> Scrap
CoreClient ..> Enigo
CoreClient ..> PortForward

IDServer ..> HbbCommon
RelayServer ..> HbbCommon

' Connection Flow
CoreClient .> IDServer : "Registers & finds peer"
CoreClient .> RelayServer : "Routes traffic (if P2P fails)"
WebClient .> IDServer : "Registers & finds peer"
WebClient .> RelayServer : "Routes traffic"

' Peer-to-peer connection
CoreClient ..left-> CoreClient : "Direct P2P Connection"

@enduml

